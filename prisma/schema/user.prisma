enum UserRole {
  DECLARANT
  INSTRUCTOR
  ADMIN
}

model User {
  id    String   @id @default(uuid()) @db.Uuid
  email String   @unique @db.Citext
  role  UserRole

  firstName String?
  lastName  String?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  declarant  Declarant?  @relation("UserDeclarant")
  instructor Instructor? @relation("UserInstructor")

  authTokens    AuthToken[]
  sessionTokens SessionToken[]
}

enum DeclarantType {
  NATURAL_PERSON
  LEGAL_PERSON
}

enum Civility {
  MR
  MRS
}

model Declarant {
  userId String @id @db.Uuid
  user   User   @relation("UserDeclarant", fields: [userId], references: [id], onDelete: Cascade)

  declarations      Declaration[]
  pointPrelevements DeclarantPointPrelevement[]

  declarantType DeclarantType @default(NATURAL_PERSON)

  socialReason String? @db.Text

  civility Civility?

  addressLine1 String? @db.Text
  addressLine2 String? @db.Text
  poBox        String? @db.Text
  postalCode   String? @db.Text
  city         String? @db.Text

  phoneNumber String? @db.Text
}

model Instructor {
  userId String @id @db.Uuid
  user   User   @relation("UserInstructor", fields: [userId], references: [id], onDelete: Cascade)

  instructorZones InstructorZone[]
}

model AuthToken {
  id    String @id @default(uuid()) @db.Uuid
  token String @unique

  userId String @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  expiresAt DateTime

  @@index([userId])
  @@index([expiresAt])
}

model SessionToken {
  id    String @id @default(uuid()) @db.Uuid
  token String @unique

  role UserRole

  userId String @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  expiresAt DateTime

  @@index([userId])
  @@index([expiresAt])
}
