// Table intermédiaire avant ingestion : une source = un lot (déclaration, API…).
// Pour l’instant une source ne contient que des données de type métrique (validateur, plus tard API).
enum SourceType {
  DECLARATION
  BATCH
  API
}

enum SourceStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

model Source {
  id     String       @id @default(uuid()) @db.Uuid
  type   SourceType
  status SourceStatus @default(PENDING)

  metadata Json?
  start    DateTime? @db.Date
  end      DateTime? @db.Date

  // Référence déclaration sans relation Prisma (Declaration ne connaît pas Source)
  declarationId String?      @db.Uuid
  declaration   Declaration? @relation(fields: [declarationId], references: [id], onDelete: Cascade)

  metrics      Metric[]
  stageMetrics StageMetric[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type])
  @@index([status])
  @@index([declarationId])
}
