enum DeclarantPointPrelevementType {
  PRELEVEUR_DECLARANT
  PRELEVEUR_NON_DECLARANT
  COLLECTEUR
}

enum DeclarantPointPrelevementStatus {
  EN_ACTIVITE
  NON_RENSEIGNE
  ABANDONNEE
  TERMINEE
}

enum UsageEau {
  EAU_POTABLE
  AGRICULTURE
  CAMION_CITERNE
  EAU_EMBOUTEILLEE
  HYDROELECTRICITE
  INDUSTRIE
  THERMALISME
  NON_RENSEIGNE
  AUTRE
}

enum WaterBodyType {
  SURFACE
  SOUTERRAIN
  TRANSITION
}

model PointPrelevement {
  id String @id @default(uuid()) @db.Uuid

  name          String         @db.Text
  waterBodyType WaterBodyType?

  coordinates Unsupported("geometry(Point,4326)")

  zones      PointPrelevementZone[]
  declarants DeclarantPointPrelevement[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  sourceId String? @db.Text

  @@unique([sourceId])
  @@index([name])
  @@index([coordinates], type: Gist)
}

model PointPrelevementZone {
  id String @id @default(uuid()) @db.Uuid

  pointPrelevementId String           @db.Uuid
  pointPrelevement   PointPrelevement @relation(fields: [pointPrelevementId], references: [id], onDelete: Cascade)

  zoneId String @db.Uuid
  zone   Zone   @relation(fields: [zoneId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([pointPrelevementId, zoneId])
  @@index([pointPrelevementId])
  @@index([zoneId])
}

model DeclarantPointPrelevement {
  id String @id @default(uuid()) @db.Uuid

  declarantUserId String    @db.Uuid
  declarant       Declarant @relation(fields: [declarantUserId], references: [userId], onDelete: Cascade)

  pointPrelevementId String           @db.Uuid
  pointPrelevement   PointPrelevement @relation(fields: [pointPrelevementId], references: [id], onDelete: Cascade)

  type DeclarantPointPrelevementType

  status    DeclarantPointPrelevementStatus @default(NON_RENSEIGNE)
  startDate DateTime?                       @db.Date
  endDate   DateTime?                       @db.Date
  usages    UsageEau[]                      @default([])

  abandonReason String? @db.Text
  comment       String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([declarantUserId, pointPrelevementId])
  @@index([declarantUserId])
  @@index([pointPrelevementId])
  @@index([type])
  @@index([status])
  @@index([startDate])
  @@index([endDate])
  @@index([usages], type: Gin)
}
