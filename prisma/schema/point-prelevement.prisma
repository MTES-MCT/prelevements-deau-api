enum DeclarantPointPrelevementType {
  PRELEVEUR
  ASA
}

model PointPrelevement {
  id String @id @default(uuid()) @db.Uuid

  name String @db.Text

  coordinates Unsupported("geometry(Point,4326)")

  zones      PointPrelevementZone[]
  declarants DeclarantPointPrelevement[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sourceId String? @db.Text

  @@unique([sourceId])
  @@index([name])
  @@index([coordinates], type: Gist)
}

model PointPrelevementZone {
  id String @id @default(uuid()) @db.Uuid

  pointPrelevementId String           @db.Uuid
  pointPrelevement   PointPrelevement @relation(fields: [pointPrelevementId], references: [id], onDelete: Cascade)

  zoneId String @db.Uuid
  zone   Zone   @relation(fields: [zoneId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([pointPrelevementId, zoneId])
  @@index([pointPrelevementId])
  @@index([zoneId])
}

model DeclarantPointPrelevement {
  id String @id @default(uuid()) @db.Uuid

  declarantUserId String    @db.Uuid
  declarant       Declarant @relation(fields: [declarantUserId], references: [userId], onDelete: Cascade)

  pointPrelevementId String           @db.Uuid
  pointPrelevement   PointPrelevement @relation(fields: [pointPrelevementId], references: [id], onDelete: Cascade)

  type DeclarantPointPrelevementType

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([declarantUserId, pointPrelevementId])
  @@index([declarantUserId])
  @@index([pointPrelevementId])
  @@index([type])
}
